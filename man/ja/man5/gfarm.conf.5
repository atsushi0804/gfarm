.\" This manpage has been automatically generated by docbook2man 
.\" from a DocBook document.  This tool can be found at:
.\" <http://shell.ipoline.com/~elmert/comp/docbook2X/> 
.\" Please send any bug reports, improvements, comments, patches, 
.\" etc. to Steve Cheng <steve@ggi-project.org>.
.TH "GFARM.CONF" "5" "19 June 2003" "Gfarm" ""
.SH NAME
gfarm.conf \- Gfarm 設定ファイル
.SH "DESCRIPTION"
.PP
gfarm.conf ファイルは、gfarm プログラムの設定ファイルです。
サーバー・プロセスである gfmd と gfsd は、デフォルトでは、
この /etc/gfarm.conf を設定ファイルとして参照します。
なお、設定内容が読み込まれるのは起動時だけなので、
設定内容を変更した場合、サーバーを再起動する必要があります。
.PP
アプリケーションプログラムは、/etc/gfarm.conf と、ユーザーの
ホームディレクトリにある .gfarmrc ファイルを、設定ファイル
として参照します。.gfarmrc ファイルは、/etc/gfarm.conf と
同一の形式で記述します。.gfarmrc と /etc/gfarm.conf では、
\&.gfarmrc の方が優先されます。
.PP
gfarm.conf は、一行に一文の形式で設定します。
ただし、行末に文字 ``\\'' を記述することによって、行を継続させることが
できます。また、文字 ``#'' から行末までは、コメントとして扱われ、無視
されます。
.SH "ホスト指定"
.PP
引数として、\fIホスト指定\fR を記述できる文がいくつかありますが、
この場合、ホスト指定には、下記のいずれかを記述できます。
.TP
\fB\fIIII.JJJ.KKK.LLL\fB\fR
"." で区切られた 0〜255 までの数字 4 つで、IP アドレスを指定します。
.TP
\fB\fIIII.JJJ.KKK.LLL\fB/\fIMM\fB\fR
IP アドレスと、"/" で区切られた 0〜31 までの数字で、ネットワークを
指定します。"/" 以降の数字は netmask のビット長です。
.TP
\fB\fIdomain.name\fB\fR
ホスト名をドメイン名で指定します。
.TP
\fB .\fIdomain.name\fB\fR
ドメイン名の先頭が "." ではじまる場合、このドメイン名に所属する全ての
ホストを意味します。
.TP
\fB*\fR
"*" と記述されている場合、全てのホストを意味します。
.TP
\fBLISTENER\fR
sockopt 文の場合、全て大文字で "LISTENER" と記述すると、されている場合、全てのホストを意味します。
.SH "文"
.PP
文には、下記の種類があります。
.TP
\fBspool \fIgfsdスプール・ディレクトリ\fB\fR
gfsdが、gfarmファイルの実体を保持するディレクトリ名を
指定します。
ファイルシステムノードではこの設定は必須です。

例:

.nf
	spool /var/spool/gfarm
.fi
.TP
\fBspool_serverport \fIgfsdポート番号\fB\fR
gfsdが利用するTCPおよびUDPポートの番号を指定します。
省略時のデフォルト・ポート番号は600番です。

例:

.nf
	spool_serverport 600
.fi
.TP
\fBmetadb_serverhost \fIgfmdホスト名\fB\fR
gfmdが動作しているホスト名を指定します。

この設定は必須です。

例:

.nf
	metadb_serverhost ldap.example.com
.fi
.TP
\fBmetadb_serverport \fIgfmdポート番号\fB\fR
gfmdが利用するTCPポートの番号を指定します。
省略時のデフォルト・ポート番号は601番です。

例:

.nf
	metadb_serverport 601
.fi
.TP
\fBldap_serverhost \fILDAPサーバー・ホスト名\fB\fR
LDAP サーバーが動作しているホスト名を指定します。

この設定は必須です。

例:

.nf
	ldap_serverhost ldap.example.com
.fi
.TP
\fBldap_serverport \fILDAPサーバー・ポート番号\fB\fR
LDAP サーバーが利用するTCPポートの番号を指定します。

現在のところ、この設定は必須です。

例:

.nf
	ldap_serverport 389
.fi
.TP
\fBldap_base_dn \fILDAP_base_distinguished_name\fB\fR
LDAP データベースで保持するデータのキーの根となるノードの
名称、base distinguished name を指定します。

この設定は必須です。

例:

.nf
	ldap_base_dn "dc=example, dc=com"
.fi
.TP
\fBauth \fI有効無効\fB \fI認証方法\fB \fIホスト指定\fB\fR
この文は、第3引数で指定したホストとの通信に用いる認証方法を設定します。

第1引数の\fI有効無効\fR部には、enable ないし disable
キーワードを指定します。
第2引数の\fI認証方法\fR部には、gsi ないし sharedsecret
キーワードを指定します。
第3引数には、\fIホスト指定\fRを記述します。

この文は複数指定可能です。各認証方法ごとに、先頭から順にホスト指定に
適合するかどうか調べ、有効であるとの指定に適合した場合、その認証方法が
利用候補になります。有効であるとの指定に適合しない場合や、あるいは
有効であるとの指定に適合するよりも前に無効であるとの指定に適合した
場合、その認証方法は、候補になりません。

この指定は、サーバー側とクライアント側の両方で解釈され、
双方ともで有効になっている認証方法のみが用いられます。

認証方法が異なるものに関しては、指定の順序は意味がありません。
複数の認証方法が候補となった場合、sharedsecret による認証が 
gsi より優先して試されます。

Gfarm のコンパイル時に globus とのリンクを指定しなかった場合、
gsi 認証は利用できません。この場合、gsi 認証の指定は単に無視されます。

この設定は必須です。

例:

.nf
	auth disable sharedsecret 192.168.0.100
	auth disable sharedsecret 192.168.0.101
	auth enable sharedsecret 192.168.0.0/24
	auth enable gsi *
.fi

この例では、ホスト 192.168.0.100 と 192.168.0.101 の 2 つのホストを
除いた 192.168.0.0/24 ネットワークに属すホストには 
sharedsecret と gsi の両方を、それ以外の全てのホスト
には gsi 認証を試みます。
すなわち、ホスト 192.168.0.100 と 192.168.0.101 の 2 つのホストは、
gsi認証のみを試みることになります。
.TP
\fBnetparam \fIパラメータ\fB=\fI値\fB [\fIホスト指定\fB]\fR
ネットワーク通信に用いる各種パラメータを指定します。
パラメータには下記のものがあります。

parallel_streams。このパラメータは、通信に利用する
TCPのストリーム数を指定します。省略時は1です。
このパラメータは、TCP の通信ウィンドウが十分なサイズ
まで開かないような遠方との通信の際に、有効なことがあります。
現在、このパラメータはファイルの複製機能でのみ有効です。
現在の実装では、gfrep(1) コマンドを起動したホストのユーザー設定ファイルの
内容が用いられます。ホスト指定と比較されるのは、複製先のホストではなく、
複製元のホストです。

stripe_unit_size。このパラメータは、通信に複数の TCP ストリーム
を利用する場合に、どのように転送内容を分割するかを指定します。
もしこの指定がない場合、転送内容を単に parallel_streams 個に
分割して送信します。
これに対し、stripe_unit_size を指定した場合は、このパラメータ
で指定したバイト数を単位としてストライピングして送信します。
通常、単なる分割よりもストライピングの方が性能的に有利です。

このパラメータは、上記の parallel_streams として 1 より大きな値
を指定した通信のみで有効です。
現在、このパラメータはファイルの複製機能でのみ有効です。
現在の実装では、gfrep(1) コマンドを起動したホストのユーザー設定ファイルの
内容が用いられます。ホスト指定と比較されるのは、複製先のホストではなく、
複製元のホストです。

rate_limit。コネクション1本あたりの通信バンド幅を制限する
実験的な機能です。指定する値の単位は bps (bit per second) です。
現在、このパラメータはファイルの複製機能でのみ有効です。
現在の実装では、複製元のホスト上の gfsd の設定ファイルが用いられます。
ホスト指定と比較されるのは、複製先のホストです。

例:

.nf
	netparam parallel_streams=2	10.0.0.0/8
	netparam stripe_unit_size=8192	10.0.0.0/8
	netparam rate_limit=750000	192.168.0.0/24
.fi
.TP
\fBsockopt \fIオプション\fB[=\fI値\fB] [LISTENER | \fIホスト指定\fB]\fR
通信 socket(2) に対して、setsockopt(2) システムコールを使って
ソケット・オプションを指定します。

第2引数に全て大文字で LISTENER を指定した場合、
サーバー側 (着呼側) のソケットに指定するオプションになります。
この場合、通信する相手に関係なく、
一律にソケット・オプションが設定されます。

第2引数にホスト指定を記述した場合、クライアント側 (発呼側) の
ソケットに指定するオプションになります。この場合、通信する相手毎に
ソケット・オプションを変えることができます。
なお、第2引数に "*" と記述すると、クライアント側 (発呼側) の全ての
ホストを意味することになり、サーバー側 (着呼側) には適用されません。

第2引数を省略した場合、サーバー側とクライアント側の両方で、
全ての通信相手に対して同じソケット・オプションを設定します。

指定可能なソケット・オプションには次のものがあります。

debug。setsockopt(2) システムコールで、SO_DEBUG ソケット・オプションを指定します。値を記述する必要はありません。

keepalive。setsockopt(2) システムコールで、SO_KEEPALIVE
ソケット・オプションを指定します。値を記述する必要はありません。

sndbuf。setsockopt(2) システムコールで、SO_SNDBUF
ソケット・オプションを指定します。値の指定が必要です。

rcvbuf。setsockopt(2) システムコールで、SO_RCVBUF
ソケット・オプションを指定します。値の指定が必要です。

tcp_nodelay。setsockopt(2) システムコールで、TCP_NODELAY
ソケット・オプションを指定します。値を記述する必要はありません。

例:

.nf
	sockopt tcp_nodelay 192.168.0.0/24
	sockopt sndbuf=1048576 10.0.0.0/8
	sockopt sndbuf=1048576 LISTENER
	sockopt rcvbuf=1048576 10.0.0.0/8
	sockopt rcvbuf=1048576 LISTENER
.fi
.TP
\fBaddress_use \fIホスト指定\fB\fR
ファイルシステムノードに複数のIPアドレスがある場合、その中のどの
IPアドレスを通信に用いるかを指定します。
この文で指定したアドレスに適合するIPアドレスを優先して使用しますが、
適合するアドレスがない場合でも、通信を行います。

例:

.nf
	address_use 192.168.0.0/24
.fi
.TP
\fBlocal_user_map \fIユーザマップファイルパス名\fB\fR
グローバルユーザ名とローカルユーザ名の対応関係を記述した
ユーザマップファイルパス名を指定します。

この設定は必須ではありませんが、同一ユーザーに対して、
異なるアカウント名を与えているファイルシステムノードがある場合に、
このファイルでユーザー名の変換を行うことができます。そのような場合、
このファイルで、各ノードのローカルなユーザ名に対して、単一の
グローバルユーザ名を定義してやることによって、UNIX 的なアカウント名が
異なっても同一ユーザとしてgfarm を利用することができます。

例:

.nf
	local_user_map /etc/gfarm/gfarm-usermap
.fi

ユーザーマップファイルは、グローバルユーザー名と
ローカルユーザー名を、空白で区切って各行に記述します。

ユーザマップファイルの内容例:

.nf
	foobar foo
	quux baz
.fi

この例の1行目の指定では、このノードのローカルユーザ名 foo に
対してグローバルユーザ名 foobar が定義されています。
.SH "GRAMMAR"
.PP
gfarm.conf の文法をBNFで記述すると、下記のようになります。

.nf
	<statement> ::=
		<spool_statement> |
		<spool_serverport_statement> |
		<metadb_serverhost_statement> |
		<metadb_serverport_statement> |
		<ldap_serverhost_statement> |
		<ldap_serverport_statement> |
		<ldap_base_dn_statement> |
		<auth_statement> |
		<netparam_statement> |
		<sockopt_statement> |
		<address_use_statement> |
		<local_user_map_statement>
	<spool_statement> ::= "spool" <pathname>
	<spool_serverport_statement> ::= "spool_serverport" <hostname>
	<metadb_serverhost_statement> ::= "metadb_serverhost" <hostname>
	<metadb_serverport_statement> ::= "metadb_serverport" <portnumber>
	<ldap_serverhost_statement> ::= "ldap_serverhost" <hostname>
	<ldap_serverport_statement> ::= "ldap_serverport" <portnumber>
	<ldap_base_dn_statement> ::= "ldap_base_dn" <string>
	<auth_statement> ::=
		"auth" <auth_command> <auth_method> <hostspec>
	<auth_command> ::= "enable" | "disable"
	<auth_method> ::= "gsi" | "sharedsecret"
	<netparam_statement> ::=
		"netparam" <netparam_option>=<number> [<hostspec>]
	<netparam_option> ::= "parallel_streams" | "stripe_unit_size" |
		"rate_limit"
	<sockopt_statement> ::=
		"sockopt" <socket_option>[=<number>] [""LISTENER" | <hostspec>]
	<socket_option> = "debug" | "keepalive" | "sndbuf" |"rcvbuf" |
		"tcp_nodelay"
	<address_use_statement> ::=  "address_use" <hostspec>
	<local_user_map_statement> ::=  "local_user_map" <pathname>
	<hostspec> ::= <ipv4_address> | <ipv4_address> "/" <address_mask> |
		<hostname> | "." <domain_name> | "*"
	<pathname> ::= <pathname_character> <pathname_character>*
	<pathname_character> ::= <hostname_character> | "," | "/" | "_"
	<hostname> ::= <hostname_character> <hostname_character>*
	<hostname_character> ::= <alphabet> | <digit> | "-" | "."
	<portnumber> ::= <number>
	<number> ::= <digit> [<digit>*]
	<digit> ::= "0" | "1" | "2" | "3" | "4" | "5" | "6" | "7" | "8" | "9"
	<string> ::= """ <double_quoted_character>* """
	<double_quoted_character> ::=
		<any_character_except_backslash_and_double_quotation> |
		"\\\\" | "\\""
.fi
.SH "EXAMPLES"

.nf
spool /var/spool/gfarm
metadb_serverhost ldap.example.com
ldap_serverhost ldap.example.com
ldap_serverport 389
ldap_base_dn "dc=example, dc=com"
auth enable sharedsecret 192.168.0.0/24
auth enable gsi *
.fi
.SH "FILES"
.TP
\fB\fI/etc/gfarm.conf\fB\fR
.TP
\fB\fI$HOME/.gfarmrc\fB\fR
.SH "SEE ALSO"
.PP
\fBgfmd\fR(8),
\fBgfsd\fR(8), \fBsetsockopt\fR(2)
