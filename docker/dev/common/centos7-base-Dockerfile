FROM centos:7

# System dependent

RUN yum -y update

# include systemd
RUN yum -y install sudo openssh-server

RUN cp /usr/share/zoneinfo/Asia/Tokyo /etc/localtime
RUN sed -i 's@^Defaults    secure_path = /sbin:/bin:/usr/sbin:/usr/bin$@Defaults    secure_path = /usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin@' \
	/etc/sudoers

RUN yum -y groupinstall "Development Tools"

RUN yum -y install epel-release openssl-devel postgresql-devel postgresql \
	postgresql-server fuse fuse-devel libacl-devel ruby

RUN yum -y --enablerepo=epel install globus-gssapi-gsi-devel globus-simple-ca \
	globus-gsi-cert-utils-progs globus-proxy-utils \
	&& globus-version

## for debug
RUN sed -i -e '/tsflags=nodocs/s/^/#/' /etc/yum.conf
RUN yum -y install \
	nc ldns iproute2 net-tools bind-utils telnet tcpdump \
	man man-pages man-db which \
	gdb valgrind strace inotify-tools \
	nano emacs-nox less

ARG GFDOCKER_USERNAME_PREFIX
ARG GFDOCKER_PRIMARY_USER
ARG GFDOCKER_NUM_GFMDS
ARG GFDOCKER_NUM_GFSDS
ARG GFDOCKER_NUM_USERS
ARG GFDOCKER_HOSTNAME_PREFIX_GFMD
ARG GFDOCKER_HOSTNAME_PREFIX_GFSD
COPY . /tmp/gfarm
COPY gfarm2fs /tmp/gfarm2fs
RUN "/tmp/gfarm/docker/dev/common/setup-univ.sh"

CMD ["/sbin/init"]
