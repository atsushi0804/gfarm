x-common:
  &x-common
  build:
    context: ../..
    dockerfile: docker/dist/Dockerfile-${DIST:-Ubuntu}
    args:
      USERNAME: $USER
  volumes:
    - ../..:/home/$USER/gfarm:cached
    - local:/home/$USER/local:cached
    - /sys/fs/cgroup:/sys/fs/cgroup:ro
  networks:
    - gfarm_net
  cap_add:
    - SYS_ADMIN
    - SYS_PTRACE
  devices:
    - /dev/fuse
  security_opt:
    - seccomp:unconfined
    - apparmor:unconfined
  privileged: false

services:
  c1:
    <<: *x-common
    hostname: c1
    container_name: gfarm-c1
  c2:
    <<: *x-common
    hostname: c2
    container_name: gfarm-c2
  c3:
    <<: *x-common
    hostname: c3
    container_name: gfarm-c3
  c4:
    <<: *x-common
    hostname: c4
    container_name: gfarm-c4

networks:
  gfarm_net:

volumes:
  local:
